
# 0. 배경

- HTTP는 요청과 응답으로 이뤄지는 하나의 사이클이 끝나면, 연결이 끊어지는 무상태성을 띄어서 클라이언트의 상태를 보존하지 않는다
- 클라이언트의 상태를 서버가 아닌 클라이언트에 저장해두고 필요시마다 데이터를 꺼내서 서버에 전달하는 방식으로 HTTP의 단점을 보완하고자 쿠키와 웹 스토리지를 사용한다

# 1. Web Storage

: 해당 도메인가 관련된 특정 데이터를 서버가 아니라 **클라이언트 웹브라우저에 저장**할 수 있도록 제공하는 기능

- key-value 쌍으로 데이터를 저장
- 서버에 전송 X → 네트워크 트래픽 비용을 줄여줌
- 모든 원시형 데이터와 객체 정보를 저장할 수 있음
- 넉넉한 데이터 저장 용량 : 모다일 2.5MB, 데스크탑 5~10MB

### 1. 보안

- 도메인 단위로 제한되는 CORS 특성 덕분에 CSRF로부터 안전

## 1. LocalStorage

: 영구 저장소. 브라우저를 닫았다가 다시 열어도 계속 유지된다.

- `window.localStorage`

### 사용 예시

- 지속적으로 데이터 저장이 필요할 때 : 자동 로그인

## 2. SessionStorage

: 임시 저장소. 브라우저가 열려있는 한 페이지를 Reload해도 계속 유지된다. 하지만 브라우저를 닫으면 삭제된다.

- `window.sessionStorage`

### 사용 예시

- 일시적으로 필요한 데이터 저장이 필요할 때 : 일회성 로그인, 입력 폼 저장, 비로그인 장바구니

# 2. Cookie

: 만료 기간이 있는 클라이언트 단에 저장하는 작은 텍스트 파일

- `document.cookie`
- 4KB, 20개의 데이터 저장 제한
- HTTP Reqeust에 암호화 되지 않은 상태로 사용하기에 보안에 취약
- 모든 HTTP Request에 포함되어 있어 웹서비스 성능에 영향을 줄 수 있음
- 방문자 정보를 컴퓨터 메모리에 저장
- 언젠가 제거됨
    - expire time을 지정하지 않으면 세션 쿠키가 됨
    - 세션 쿠키 : 웹 브라우저를 닫을 때 삭제됨
- 서버에 요청시 세션보다 속도가 빠름

### 사용 예시

- 일시적으로 필요한 가벼운 데이터 저장이 필요할 때 : 다시 보지 않음 쿠키 팝업창, 로그인 자동 완성

### 1. 쿠키 동작 원리

1. 클라이언트가 서버에 HTTP 요청
2. 서버가 HTTP 응답시 `set-cookie`를 통해 쿠키 생성하여 전달
    - client에서도 쿠키 설정 가능
3. 클라이언트는 이제부터 매 `HTTP Request`시 `HTTP Header`에 쿠키담아서 전송
4. 만료 기간 전이라면, 쿠키는 브라우저에 저장되어 있으며, 항상 요청시 사용 가능
5. 만료됬다면, 클라이언트가 새로 서버에 요청하여 쿠키 새로 발급

### 2. 쿠키 저장 방법

### 3. 보안

- `XSS`(사이트간 악성 JS 코드 심는 행위)로부터 안전
    - 서버에서 쿠키의 httpOnly 옵션을 설정하면, JS에서 쿠키에 접근 자체가 불가능
- `CSRF`(사이트 간 요청 위조) 에 취약 : 공격자가 사용자의 요청을 가로챈 뒤 사용자의 의지와 상관없이 보안적으로 위험한 행동을 하게끔 변조하여 부당 이익을 취하는 행위

## 1. Persistent Cookie

: 만료일 포함 X

- 브라우저/탭이 열려있는 동안만 저장

## 2. Session Cookie

: 만료일 포함 O

- 유저의 디스크에 저장되고 만료일이 지나면 삭제됨

# 3. Session (브라우저 저장소에 해당 X)

- 방문자 정보를 웹 서버가 세션 아이디 파일을 만들어 서비스가 돌아가고 있는 서버에 저장
- 쿠키와 달리 세션은 사용자의 **로그인 정보에 대한 보안을 한층 업그레이드** 할 수 있기 때문에, 웹사이트에 방문하여 계속 접속을 유지할 때 이전의 접속 정보를 이용할 수 있는 방법으로 많이 사용함
- 보안이 쿠키보다 좋음
    - 사용자가 많아질수록 서버 메모리를 많이 차지
- 정보가 서버에 있기에 처리가 요구되어서 비교적 속도가 느린 편
